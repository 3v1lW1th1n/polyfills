{"version":3,"sources":["src/template-map.js","src/css-parse.js","src/apply-shim-utils.js","src/common-regex.js","src/style-settings.js","src/style-util.js","src/apply-shim.js","entrypoints/apply-shim.js","src/common-utils.js"],"names":["$jscompDefaultExport","constructor","StyleNode","parse$$module$$src$css_parse","parse","text","replace","RX$$module$$src$css_parse.comments","RX$$module$$src$css_parse.port","parseCss","root","length","n","i","l","OPEN_BRACE","p","previous","push","CLOSE_BRACE","parseCss$$module$$src$css_parse","node","t","substring","trim","ss","_expandUnicodeEscapes","RX$$module$$src$css_parse.multipleSpaces","lastIndexOf","s","indexOf","AT_START","MEDIA_START","match","RX$$module$$src$css_parse.keyframesRule","types$$module$$src$css_parse.KEYFRAMES_RULE","split","pop","types$$module$$src$css_parse.MEDIA_RULE","VAR_START","types$$module$$src$css_parse.STYLE_RULE","types$$module$$src$css_parse.MIXIN_RULE","r$","r","_expandUnicodeEscapes$$module$$src$css_parse","code","repeat","stringify$$module$$src$css_parse","stringify","preserveProperties","cssText","rules","RX$$module$$src$css_parse.customProp","RX$$module$$src$css_parse.mixinProp","RX$$module$$src$css_parse.mixinApply","RX$$module$$src$css_parse.varApply","STYLE_RULE","KEYFRAMES_RULE","MEDIA_RULE","MIXIN_RULE","comments","port","customProp","mixinProp","mixinApply","varApply","keyframesRule","multipleSpaces","promise","Promise","resolve","startValidatingTemplate$$module$$src$apply_shim_utils","startValidatingTemplate","template","_validating","then","VAR_ASSIGN","MIXIN_MATCH","MEDIA_MATCH","nativeCssVariables","navigator","userAgent","window","CSS","supports","parseSettings$$module$$src$style_settings","parseSettings","settings","module$$src$style_settings.nativeCssVariables","toCssText$$module$$src$style_util","toCssText","rulesForStyle$$module$$src$style_util","rulesForStyle","style","textContent","forEachRule$$module$$src$style_util","forEachRule","styleRuleCallback","keyframesRuleCallback","onlyActiveRules","skipRules","type","matchMedia","matches","processVariableAndFallback$$module$$src$style_util","processVariableAndFallback","str","callback","start","end","level","inner","prefix","suffix","comma","value","fallback","APPLY_NAME_CLEAN","INITIAL_INHERIT","MixinMap","_map","set","name","props","properties","dependants","get","invalidCallback","ApplyShim","_measureElement","_currentElement","detectMixin","has","test","lastIndex","transformTemplate","elementName","content","querySelector","ast","transformStyle","transformRules","transformCustomStyle","rule","transformRule","transformCssText","matchText","propertyName","valueProperty","valueMixin","_produceCssProperties","_consumeCssProperties","m","exec","mixinName","idx","index","textBeforeApply","slice","textAfterApply","defaults","_cssTextToMap","f","parts","_atApplyToCssProperties","vars","mixinEntry","fallbacks","MIXIN_VAR_SEP","join","replacement","property","out","sp","_replaceInitialOrInherit","document","createElement","setAttribute","all","head","appendChild","getComputedStyle","getPropertyValue","_invalidateMixinEntry","mixinAsProperties","combinedProps","mixinValues","oldProps","Object","assign","create","v","needToInvalidate","undefined","prototype","defineProperty","cb","applyShim","ensure","booted","customStyleInterface","flushCustomStyles","styles","cs","styleDocument","styleSubtree","documentElement","element","removeProperty","setProperty","shadowRoot","styleElement","shadowChildren","children","childNodes","is","getAttribute","localName","prepareTemplate","applyShimInterface"],"mappings":"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","file":"apply-shim.min.js","sourcesContent":["/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nexport default {};\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n/*\nExtremely simple css parser. Intended to be not more than what we need\nand definitely not necessarily correct =).\n*/\n\n'use strict';\n\n/** @unrestricted */\nclass StyleNode {\n  constructor() {\n    /** @type {number} */\n    this['start'] = 0;\n    /** @type {number} */\n    this['end'] = 0;\n    /** @type {StyleNode} */\n    this['previous'] = null;\n    /** @type {StyleNode} */\n    this['parent'] = null;\n    /** @type {Array<StyleNode>} */\n    this['rules'] = null;\n    /** @type {string} */\n    this['parsedCssText'] = '';\n    /** @type {string} */\n    this['cssText'] = '';\n    /** @type {boolean} */\n    this['atRule'] = false;\n    /** @type {number} */\n    this['type'] = 0;\n    /** @type {string} */\n    this['keyframesName'] = '';\n    /** @type {string} */\n    this['selector'] = '';\n    /** @type {string} */\n    this['parsedSelector'] = '';\n  }\n}\n\nexport {StyleNode}\n\n// given a string of css, return a simple rule tree\n/**\n * @param {string} text\n * @return {StyleNode}\n */\nexport function parse(text) {\n  text = clean(text);\n  return parseCss(lex(text), text);\n}\n\n// remove stuff we don't care about that may hinder parsing\n/**\n * @param {string} cssText\n * @return {string}\n */\nfunction clean(cssText) {\n  return cssText.replace(RX.comments, '').replace(RX.port, '');\n}\n\n// super simple {...} lexer that returns a node tree\n/**\n * @param {string} text\n * @return {StyleNode}\n */\nfunction lex(text) {\n  let root = new StyleNode();\n  root['start'] = 0;\n  root['end'] = text.length\n  let n = root;\n  for (let i = 0, l = text.length; i < l; i++) {\n    if (text[i] === OPEN_BRACE) {\n      if (!n['rules']) {\n        n['rules'] = [];\n      }\n      let p = n;\n      let previous = p['rules'][p['rules'].length - 1] || null;\n      n = new StyleNode();\n      n['start'] = i + 1;\n      n['parent'] = p;\n      n['previous'] = previous;\n      p['rules'].push(n);\n    } else if (text[i] === CLOSE_BRACE) {\n      n['end'] = i + 1;\n      n = n['parent'] || root;\n    }\n  }\n  return root;\n}\n\n// add selectors/cssText to node tree\n/**\n * @param {StyleNode} node\n * @param {string} text\n * @return {StyleNode}\n */\nfunction parseCss(node, text) {\n  let t = text.substring(node['start'], node['end'] - 1);\n  node['parsedCssText'] = node['cssText'] = t.trim();\n  if (node['parent']) {\n    let ss = node['previous'] ? node['previous']['end'] : node['parent']['start'];\n    t = text.substring(ss, node['start'] - 1);\n    t = _expandUnicodeEscapes(t);\n    t = t.replace(RX.multipleSpaces, ' ');\n    // TODO(sorvell): ad hoc; make selector include only after last ;\n    // helps with mixin syntax\n    t = t.substring(t.lastIndexOf(';') + 1);\n    let s = node['parsedSelector'] = node['selector'] = t.trim();\n    node['atRule'] = (s.indexOf(AT_START) === 0);\n    // note, support a subset of rule types...\n    if (node['atRule']) {\n      if (s.indexOf(MEDIA_START) === 0) {\n        node['type'] = types.MEDIA_RULE;\n      } else if (s.match(RX.keyframesRule)) {\n        node['type'] = types.KEYFRAMES_RULE;\n        node['keyframesName'] =\n          node['selector'].split(RX.multipleSpaces).pop();\n      }\n    } else {\n      if (s.indexOf(VAR_START) === 0) {\n        node['type'] = types.MIXIN_RULE;\n      } else {\n        node['type'] = types.STYLE_RULE;\n      }\n    }\n  }\n  let r$ = node['rules'];\n  if (r$) {\n    for (let i = 0, l = r$.length, r;\n      (i < l) && (r = r$[i]); i++) {\n      parseCss(r, text);\n    }\n  }\n  return node;\n}\n\n/**\n * conversion of sort unicode escapes with spaces like `\\33 ` (and longer) into\n * expanded form that doesn't require trailing space `\\000033`\n * @param {string} s\n * @return {string}\n */\nfunction _expandUnicodeEscapes(s) {\n  return s.replace(/\\\\([0-9a-f]{1,6})\\s/gi, function() {\n    let code = arguments[1],\n      repeat = 6 - code.length;\n    while (repeat--) {\n      code = '0' + code;\n    }\n    return '\\\\' + code;\n  });\n}\n\n/**\n * stringify parsed css.\n * @param {StyleNode} node\n * @param {boolean=} preserveProperties\n * @param {string=} text\n * @return {string}\n */\nexport function stringify(node, preserveProperties, text = '') {\n  // calc rule cssText\n  let cssText = '';\n  if (node['cssText'] || node['rules']) {\n    let r$ = node['rules'];\n    if (r$ && !_hasMixinRules(r$)) {\n      for (let i = 0, l = r$.length, r;\n        (i < l) && (r = r$[i]); i++) {\n        cssText = stringify(r, preserveProperties, cssText);\n      }\n    } else {\n      cssText = preserveProperties ? node['cssText'] :\n        removeCustomProps(node['cssText']);\n      cssText = cssText.trim();\n      if (cssText) {\n        cssText = '  ' + cssText + '\\n';\n      }\n    }\n  }\n  // emit rule if there is cssText\n  if (cssText) {\n    if (node['selector']) {\n      text += node['selector'] + ' ' + OPEN_BRACE + '\\n';\n    }\n    text += cssText;\n    if (node['selector']) {\n      text += CLOSE_BRACE + '\\n\\n';\n    }\n  }\n  return text;\n}\n\n/**\n * @param {Array<StyleNode>} rules\n * @return {boolean}\n */\nfunction _hasMixinRules(rules) {\n  let r = rules[0];\n  return Boolean(r) && Boolean(r['selector']) && r['selector'].indexOf(VAR_START) === 0;\n}\n\n/**\n * @param {string} cssText\n * @return {string}\n */\nfunction removeCustomProps(cssText) {\n  cssText = removeCustomPropAssignment(cssText);\n  return removeCustomPropApply(cssText);\n}\n\n/**\n * @param {string} cssText\n * @return {string}\n */\nexport function removeCustomPropAssignment(cssText) {\n  return cssText\n    .replace(RX.customProp, '')\n    .replace(RX.mixinProp, '');\n}\n\n/**\n * @param {string} cssText\n * @return {string}\n */\nfunction removeCustomPropApply(cssText) {\n  return cssText\n    .replace(RX.mixinApply, '')\n    .replace(RX.varApply, '');\n}\n\n/** @enum {number} */\nexport const types = {\n  STYLE_RULE: 1,\n  KEYFRAMES_RULE: 7,\n  MEDIA_RULE: 4,\n  MIXIN_RULE: 1000\n}\n\nconst OPEN_BRACE = '{';\nconst CLOSE_BRACE = '}';\n\n// helper regexp's\nconst RX = {\n  comments: /\\/\\*[^*]*\\*+([^/*][^*]*\\*+)*\\//gim,\n  port: /@import[^;]*;/gim,\n  customProp: /(?:^[^;\\-\\s}]+)?--[^;{}]*?:[^{};]*?(?:[;\\n]|$)/gim,\n  mixinProp: /(?:^[^;\\-\\s}]+)?--[^;{}]*?:[^{};]*?{[^}]*?}(?:[;\\n]|$)?/gim,\n  mixinApply: /@apply\\s*\\(?[^);]*\\)?\\s*(?:[;\\n]|$)?/gim,\n  varApply: /[^;:]*?:[^;]*?var\\([^;]*\\)(?:[;\\n]|$)?/gim,\n  keyframesRule: /^@[^\\s]*keyframes/,\n  multipleSpaces: /\\s+/g\n}\n\nconst VAR_START = '--';\nconst MEDIA_START = '@media';\nconst AT_START = '@';\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\nimport templateMap from './template-map'\nimport {StyleNode} from './css-parse' // eslint-disable-line no-unused-vars\n\n/**\n * @const {Promise<void>}\n */\nconst promise = Promise.resolve();\n\nexport function invalidate(elementName){\n  let template = templateMap[elementName];\n  if (template) {\n    invalidateTemplate(template);\n  }\n}\n\nexport function invalidateTemplate(template) {\n  template['_applyShimInvalid'] = true;\n}\n\nexport function isValid(elementName) {\n  let template = templateMap[elementName];\n  if (template) {\n    return templateIsValid(template);\n  }\n  return true;\n}\n\nexport function templateIsValid(template) {\n  return !template['_applyShimInvalid'];\n}\n\nexport function isValidating(elementName) {\n  let template = templateMap[elementName];\n  if (template) {\n    return templateIsValidating(template);\n  }\n  return false;\n}\n\nexport function templateIsValidating(template) {\n  return template._validating;\n}\n\n/*\nthe template is marked as `validating` for one microtask so that all instances\nfound in the tree crawl of `applyStyle` will update themselves,\nbut the template will only be updated once.\n*/\nexport function startValidating(elementName) {\n  let template = templateMap[elementName];\n  startValidatingTemplate(template);\n}\n\nexport function startValidatingTemplate(template) {\n  if (!template._validating) {\n    template._validating = true;\n    promise.then(function() {\n      template['_applyShimInvalid'] = false;\n      template._validating = false;\n    });\n  }\n}\n\nexport function elementsAreInvalid() {\n  for (let elementName in templateMap) {\n    let template = templateMap[elementName];\n    if (!templateIsValid(template)) {\n      return true;\n    }\n  }\n  return false;\n}","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nexport const VAR_ASSIGN = /(?:^|[;\\s{]\\s*)(--[\\w-]*?)\\s*:\\s*(?:([^;{]*)|{([^}]*)})(?:(?=[;\\s}])|$)/gi;\nexport const MIXIN_MATCH = /(?:^|\\W+)@apply\\s*\\(?([^);\\n]*)\\)?/gi;\nexport const VAR_CONSUMED = /(--[\\w-]+)\\s*([:,;)]|$)/gi;\nexport const ANIMATION_MATCH = /(animation\\s*:)|(animation-name\\s*:)/;\nexport const MEDIA_MATCH = /@media[^(]*(\\([^)]*\\))/;\nexport const IS_VAR = /^--/;\nexport const BRACKETED = /\\{[^}]*\\}/g;\nexport const HOST_PREFIX = '(?:^|[^.#[:])';\nexport const HOST_SUFFIX = '($|[.:[\\\\s>+~])';","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nexport let nativeShadow = !(window['ShadyDOM'] && window['ShadyDOM']['inUse']);\n// chrome 49 has semi-working css vars, check if box-shadow works\n// safari 9.1 has a recalc bug: https://bugs.webkit.org/show_bug.cgi?id=155782\nexport let nativeCssVariables = (!navigator.userAgent.match('AppleWebKit/601') &&\nwindow.CSS && CSS.supports && CSS.supports('box-shadow', '0 0 0 var(--foo)'));\n\n/**\n * @param {?Object} settings\n */\nfunction parseSettings(settings) {\n  if (settings) {\n    nativeCssVariables = nativeCssVariables && !settings['shimcssproperties'];\n    nativeShadow = nativeShadow && !settings['shimshadow'];\n  }\n}\n\nif (window['ShadyCSS']) {\n  parseSettings(window['ShadyCSS']);\n} else if (window['WebComponents']) {\n  parseSettings(window['WebComponents']['flags']);\n}\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport {nativeShadow, nativeCssVariables} from './style-settings'\nimport {parse, stringify, types, StyleNode} from './css-parse' // eslint-disable-line no-unused-vars\nimport {MEDIA_MATCH} from './common-regex';\n\n/**\n * @param {string|StyleNode} rules\n * @param {function(StyleNode)=} callback\n */\nexport function toCssText (rules, callback) {\n  if (typeof rules === 'string') {\n    rules = parse(rules);\n  }\n  if (callback) {\n    forEachRule(rules, callback);\n  }\n  return stringify(rules, nativeCssVariables);\n}\n\n/**\n * @param {HTMLStyleElement} style\n * @return {StyleNode}\n */\nexport function rulesForStyle(style) {\n  if (!style['__cssRules'] && style.textContent) {\n    style['__cssRules'] = parse(style.textContent);\n  }\n  return style['__cssRules'];\n}\n\n// Tests if a rule is a keyframes selector, which looks almost exactly\n// like a normal selector but is not (it has nothing to do with scoping\n// for example).\n/**\n * @param {StyleNode} rule\n * @return {boolean}\n */\nexport function isKeyframesSelector(rule) {\n  return Boolean(rule['parent']) &&\n  rule['parent']['type'] === types.KEYFRAMES_RULE;\n}\n\n/**\n * @param {StyleNode} node\n * @param {Function=} styleRuleCallback\n * @param {Function=} keyframesRuleCallback\n * @param {boolean=} onlyActiveRules\n */\nexport function forEachRule(node, styleRuleCallback, keyframesRuleCallback, onlyActiveRules) {\n  if (!node) {\n    return;\n  }\n  let skipRules = false;\n  let type = node['type'];\n  if (onlyActiveRules) {\n    if (type === types.MEDIA_RULE) {\n      let matchMedia = node['selector'].match(MEDIA_MATCH);\n      if (matchMedia) {\n        // if rule is a non matching @media rule, skip subrules\n        if (!window.matchMedia(matchMedia[1]).matches) {\n          skipRules = true;\n        }\n      }\n    }\n  }\n  if (type === types.STYLE_RULE) {\n    styleRuleCallback(node);\n  } else if (keyframesRuleCallback &&\n    type === types.KEYFRAMES_RULE) {\n    keyframesRuleCallback(node);\n  } else if (type === types.MIXIN_RULE) {\n    skipRules = true;\n  }\n  let r$ = node['rules'];\n  if (r$ && !skipRules) {\n    for (let i=0, l=r$.length, r; (i<l) && (r=r$[i]); i++) {\n      forEachRule(r, styleRuleCallback, keyframesRuleCallback, onlyActiveRules);\n    }\n  }\n}\n\n// add a string of cssText to the document.\n/**\n * @param {string} cssText\n * @param {string} moniker\n * @param {Node} target\n * @param {Node} contextNode\n * @return {HTMLStyleElement}\n */\nexport function applyCss(cssText, moniker, target, contextNode) {\n  let style = createScopeStyle(cssText, moniker);\n  return applyStyle(style, target, contextNode);\n}\n\n/**\n * @param {Node} style\n * @param {?Node} target\n * @param {?Node} contextNode\n * @return {HTMLStyleElement}\n */\nexport function applyStyle(style, target, contextNode) {\n  target = target || document.head;\n  let after = (contextNode && contextNode.nextSibling) ||\n  target.firstChild;\n  lastHeadApplyNode = style;\n  return /** @type {HTMLStyleElement} */(target.insertBefore(style, after));\n}\n\n/**\n * @param {string} cssText\n * @param {string} moniker\n * @return {Element}\n */\nexport function createScopeStyle(cssText, moniker) {\n  let style = document.createElement('style');\n  if (moniker) {\n    style.setAttribute('scope', moniker);\n  }\n  style.textContent = cssText;\n  return style;\n}\n\n/** @type {Node} */\nlet lastHeadApplyNode = null;\n\n// insert a comment node as a styling position placeholder.\n/**\n * @param {string} moniker\n * @return {Node}\n */\nexport function applyStylePlaceHolder(moniker) {\n  let placeHolder = document.createComment(' Shady DOM styles for ' +\n    moniker + ' ');\n  let after = lastHeadApplyNode ?\n    lastHeadApplyNode['nextSibling'] : null;\n  let scope = document.head;\n  scope.insertBefore(placeHolder, after || scope.firstChild);\n  lastHeadApplyNode = placeHolder;\n  return placeHolder;\n}\n\n/**\n * @param {string} buildType\n * @return {boolean}\n */\nexport function isTargetedBuild(buildType) {\n  return nativeShadow ? buildType === 'shadow' : buildType === 'shady';\n}\n\n/**\n * @param {Element} element\n * @return {?string}\n */\nexport function getCssBuildType(element) {\n  return element.getAttribute('css-build');\n}\n\n/**\n * Walk from text[start] matching parens and\n * returns position of the outer end paren\n * @param {string} text\n * @param {number} start\n * @return {number}\n */\nfunction findMatchingParen(text, start) {\n  let level = 0;\n  for (let i=start, l=text.length; i < l; i++) {\n    if (text[i] === '(') {\n      level++;\n    } else if (text[i] === ')') {\n      if (--level === 0) {\n        return i;\n      }\n    }\n  }\n  return -1;\n}\n\n/**\n * @param {string} str\n * @param {function(string, string, string, string)} callback\n */\nexport function processVariableAndFallback(str, callback) {\n  // find 'var('\n  let start = str.indexOf('var(');\n  if (start === -1) {\n    // no var?, everything is prefix\n    return callback(str, '', '', '');\n  }\n  //${prefix}var(${inner})${suffix}\n  let end = findMatchingParen(str, start + 3);\n  let inner = str.substring(start + 4, end);\n  let prefix = str.substring(0, start);\n  // suffix may have other variables\n  let suffix = processVariableAndFallback(str.substring(end + 1), callback);\n  let comma = inner.indexOf(',');\n  // value and fallback args should be trimmed to match in property lookup\n  if (comma === -1) {\n    // variable, no fallback\n    return callback(prefix, inner.trim(), '', suffix);\n  }\n  // var(${value},${fallback})\n  let value = inner.substring(0, comma).trim();\n  let fallback = inner.substring(comma + 1).trim();\n  return callback(prefix, value, fallback, suffix);\n}\n\n/**\n * @param {Element} element\n * @param {string} value\n */\nexport function setElementClassRaw(element, value) {\n  // use native setAttribute provided by ShadyDOM when setAttribute is patched\n  if (window['ShadyDOM']) {\n    window['ShadyDOM']['nativeMethods']['setAttribute'].call(element, 'class', value);\n  } else {\n    element.setAttribute('class', value);\n  }\n}\n\n/**\n * @param {Element|Object} element\n * @return {{is: string, extends: string}}\n */\nexport function getIsExtends(element) {\n  let is = element.is || (element.getAttribute && element.getAttribute('is')) || element.localName;\n  let extendz = element.extends || element.localName !== is ? element.localName : '';\n  return {is, extends: extendz};\n}","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n/*\n * The apply shim simulates the behavior of `@apply` proposed at\n * https://tabatkins.github.io/specs/css-apply-rule/.\n * The approach is to convert a property like this:\n *\n *    --foo: {color: red; background: blue;}\n *\n * to this:\n *\n *    --foo_-_color: red;\n *    --foo_-_background: blue;\n *\n * Then where `@apply --foo` is used, that is converted to:\n *\n *    color: var(--foo_-_color);\n *    background: var(--foo_-_background);\n *\n * This approach generally works but there are some issues and limitations.\n * Consider, for example, that somewhere *between* where `--foo` is set and used,\n * another element sets it to:\n *\n *    --foo: { border: 2px solid red; }\n *\n * We must now ensure that the color and background from the previous setting\n * do not apply. This is accomplished by changing the property set to this:\n *\n *    --foo_-_border: 2px solid red;\n *    --foo_-_color: initial;\n *    --foo_-_background: initial;\n *\n * This works but introduces one new issue.\n * Consider this setup at the point where the `@apply` is used:\n *\n *    background: orange;\n *    @apply --foo;\n *\n * In this case the background will be unset (initial) rather than the desired\n * `orange`. We address this by altering the property set to use a fallback\n * value like this:\n *\n *    color: var(--foo_-_color);\n *    background: var(--foo_-_background, orange);\n *    border: var(--foo_-_border);\n *\n * Note that the default is retained in the property set and the `background` is\n * the desired `orange`. This leads us to a limitation.\n *\n * Limitation 1:\n\n * Only properties in the rule where the `@apply`\n * is used are considered as default values.\n * If another rule matches the element and sets `background` with\n * less specificity than the rule in which `@apply` appears,\n * the `background` will not be set.\n *\n * Limitation 2:\n *\n * When using Polymer's `updateStyles` api, new properties may not be set for\n * `@apply` properties.\n\n*/\n\n'use strict';\n\nimport {forEachRule, processVariableAndFallback, rulesForStyle, toCssText} from './style-util'\nimport {MIXIN_MATCH, VAR_ASSIGN} from './common-regex'\nimport {StyleNode} from './css-parse' // eslint-disable-line no-unused-vars\n\nconst APPLY_NAME_CLEAN = /;\\s*/m;\nconst INITIAL_INHERIT = /^\\s*(initial)|(inherit)\\s*$/;\n\n// separator used between mixin-name and mixin-property-name when producing properties\n// NOTE: plain '-' may cause collisions in user styles\nconst MIXIN_VAR_SEP = '_-_';\n\n/**\n * @typedef {!Object<string, string>}\n */\nlet PropertyEntry; // eslint-disable-line no-unused-vars\n\n/**\n * @typedef {!Object<string, boolean>}\n */\nlet DependantsEntry; // eslint-disable-line no-unused-vars\n\n/** @typedef {{\n *    properties: PropertyEntry,\n *    dependants: DependantsEntry\n * }}\n */\nlet MixinMapEntry; // eslint-disable-line no-unused-vars\n\n// map of mixin to property names\n// --foo: {border: 2px} -> {properties: {(--foo, ['border'])}, dependants: {'element-name': proto}}\nclass MixinMap {\n  constructor() {\n    /** @type {!Object<string, !MixinMapEntry>} */\n    this._map = {};\n  }\n  /**\n   * @param {string} name\n   * @param {!PropertyEntry} props\n   */\n  set(name, props) {\n    name = name.trim();\n    this._map[name] = {\n      properties: props,\n      dependants: {}\n    }\n  }\n  /**\n   * @param {string} name\n   * @return {MixinMapEntry}\n   */\n  get(name) {\n    name = name.trim();\n    return this._map[name] || null;\n  }\n}\n\n/**\n * Callback for when an element is marked invalid\n * @type {?function(string)}\n */\nlet invalidCallback = null;\n\n/** @unrestricted */\nclass ApplyShim {\n  constructor() {\n    /** @type {?string} */\n    this._currentElement = null;\n    /** @type {HTMLMetaElement} */\n    this._measureElement = null;\n    this._map = new MixinMap();\n  }\n  /**\n   * return true if `cssText` contains a mixin definition or consumption\n   * @param {string} cssText\n   * @return {boolean}\n   */\n  detectMixin(cssText) {\n    const has = MIXIN_MATCH.test(cssText) || VAR_ASSIGN.test(cssText);\n    // reset state of the regexes\n    MIXIN_MATCH.lastIndex = 0;\n    VAR_ASSIGN.lastIndex = 0;\n    return has;\n  }\n  /**\n   * @param {!HTMLTemplateElement} template\n   * @param {string} elementName\n   * @return {StyleNode}\n   */\n  transformTemplate(template, elementName) {\n    const style = /** @type {HTMLStyleElement} */(template.content.querySelector('style'));\n    /** @type {StyleNode} */\n    let ast = null;\n    if (style) {\n      ast = this.transformStyle(style, elementName);\n    }\n    return ast;\n  }\n  /**\n   * @param {!HTMLStyleElement} style\n   * @param {string} elementName\n   * @return {StyleNode}\n   */\n  transformStyle(style, elementName = '') {\n    let ast = rulesForStyle(style);\n    this.transformRules(ast, elementName);\n    style.textContent = toCssText(ast);\n    return ast;\n  }\n  /**\n   * @param {!HTMLStyleElement} style\n   * @return {StyleNode}\n   */\n  transformCustomStyle(style) {\n    let ast = rulesForStyle(style);\n    forEachRule(ast, (rule) => {\n      if (rule['selector'] === ':root') {\n        rule['selector'] = 'html';\n      }\n      this.transformRule(rule);\n    })\n    style.textContent = toCssText(ast);\n    return ast;\n  }\n  /**\n   * @param {StyleNode} rules\n   * @param {string} elementName\n   */\n  transformRules(rules, elementName) {\n    this._currentElement = elementName;\n    forEachRule(rules, (r) => {\n      this.transformRule(r);\n    });\n    this._currentElement = null;\n  }\n  /**\n   * @param {!StyleNode} rule\n   */\n  transformRule(rule) {\n    rule['cssText'] = this.transformCssText(rule['parsedCssText']);\n    // :root was only used for variable assignment in property shim,\n    // but generates invalid selectors with real properties.\n    // replace with `:host > *`, which serves the same effect\n    if (rule['selector'] === ':root') {\n      rule['selector'] = ':host > *';\n    }\n  }\n  /**\n   * @param {string} cssText\n   * @return {string}\n   */\n  transformCssText(cssText) {\n    // produce variables\n    cssText = cssText.replace(VAR_ASSIGN, (matchText, propertyName, valueProperty, valueMixin) =>\n      this._produceCssProperties(matchText, propertyName, valueProperty, valueMixin));\n    // consume mixins\n    return this._consumeCssProperties(cssText);\n  }\n  /**\n   * @param {string} property\n   * @return {string}\n   */\n  _getInitialValueForProperty(property) {\n    if (!this._measureElement) {\n      this._measureElement = /** @type {HTMLMetaElement} */(document.createElement('meta'));\n      this._measureElement.setAttribute('apply-shim-measure', '');\n      this._measureElement.style.all = 'initial';\n      document.head.appendChild(this._measureElement);\n    }\n    return window.getComputedStyle(this._measureElement).getPropertyValue(property);\n  }\n  /**\n   * replace mixin consumption with variable consumption\n   * @param {string} text\n   * @return {string}\n   */\n  _consumeCssProperties(text) {\n    /** @type {Array} */\n    let m = null;\n    // loop over text until all mixins with defintions have been applied\n    while((m = MIXIN_MATCH.exec(text))) {\n      let matchText = m[0];\n      let mixinName = m[1];\n      let idx = m.index;\n      // collect properties before apply to be \"defaults\" if mixin might override them\n      // match includes a \"prefix\", so find the start and end positions of @apply\n      let applyPos = idx + matchText.indexOf('@apply');\n      let afterApplyPos = idx + matchText.length;\n      // find props defined before this @apply\n      let textBeforeApply = text.slice(0, applyPos);\n      let textAfterApply = text.slice(afterApplyPos);\n      let defaults = this._cssTextToMap(textBeforeApply);\n      let replacement = this._atApplyToCssProperties(mixinName, defaults);\n      // use regex match position to replace mixin, keep linear processing time\n      text = `${textBeforeApply}${replacement}${textAfterApply}`;\n      // move regex search to _after_ replacement\n      MIXIN_MATCH.lastIndex = idx + replacement.length;\n    }\n    return text;\n  }\n  /**\n   * produce variable consumption at the site of mixin consumption\n   * @apply --foo; -> for all props (${propname}: var(--foo_-_${propname}, ${fallback[propname]}}))\n   * Example:\n   *  border: var(--foo_-_border); padding: var(--foo_-_padding, 2px)\n   *\n   * @param {string} mixinName\n   * @param {Object} fallbacks\n   * @return {string}\n   */\n  _atApplyToCssProperties(mixinName, fallbacks) {\n    mixinName = mixinName.replace(APPLY_NAME_CLEAN, '');\n    let vars = [];\n    let mixinEntry = this._map.get(mixinName);\n    // if we depend on a mixin before it is created\n    // make a sentinel entry in the map to add this element as a dependency for when it is defined.\n    if (!mixinEntry) {\n      this._map.set(mixinName, {});\n      mixinEntry = this._map.get(mixinName);\n    }\n    if (mixinEntry) {\n      if (this._currentElement) {\n        mixinEntry.dependants[this._currentElement] = true;\n      }\n      let p, parts, f;\n      for (p in mixinEntry.properties) {\n        f = fallbacks && fallbacks[p];\n        parts = [p, ': var(', mixinName, MIXIN_VAR_SEP, p];\n        if (f) {\n          parts.push(',', f);\n        }\n        parts.push(')');\n        vars.push(parts.join(''));\n      }\n    }\n    return vars.join('; ');\n  }\n\n  /**\n   * @param {string} property\n   * @param {string} value\n   * @return {string}\n   */\n  _replaceInitialOrInherit(property, value) {\n    let match = INITIAL_INHERIT.exec(value);\n    if (match) {\n      if (match[1]) {\n        // initial\n        // replace `initial` with the concrete initial value for this property\n        value = this._getInitialValueForProperty(property);\n      } else {\n        // inherit\n        // with this purposfully illegal value, the variable will be invalid at\n        // compute time (https://www.w3.org/TR/css-variables/#invalid-at-computed-value-time)\n        // and for inheriting values, will behave similarly\n        // we cannot support the same behavior for non inheriting values like 'border'\n        value = 'apply-shim-inherit';\n      }\n    }\n    return value;\n  }\n\n  /**\n   * \"parse\" a mixin definition into a map of properties and values\n   * cssTextToMap('border: 2px solid black') -> ('border', '2px solid black')\n   * @param {string} text\n   * @return {!Object<string, string>}\n   */\n  _cssTextToMap(text) {\n    let props = text.split(';');\n    let property, value;\n    let out = {};\n    for (let i = 0, p, sp; i < props.length; i++) {\n      p = props[i];\n      if (p) {\n        sp = p.split(':');\n        // ignore lines that aren't definitions like @media\n        if (sp.length > 1) {\n          property = sp[0].trim();\n          // some properties may have ':' in the value, like data urls\n          value = this._replaceInitialOrInherit(property, sp.slice(1).join(':'));\n          out[property] = value;\n        }\n      }\n    }\n    return out;\n  }\n\n  /**\n   * @param {MixinMapEntry} mixinEntry\n   */\n  _invalidateMixinEntry(mixinEntry) {\n    if (!invalidCallback) {\n      return;\n    }\n    for (let elementName in mixinEntry.dependants) {\n      if (elementName !== this._currentElement) {\n        invalidCallback(elementName);\n      }\n    }\n  }\n\n  /**\n   * @param {string} matchText\n   * @param {string} propertyName\n   * @param {?string} valueProperty\n   * @param {?string} valueMixin\n   * @return {string}\n   */\n  _produceCssProperties(matchText, propertyName, valueProperty, valueMixin) {\n    // handle case where property value is a mixin\n    if (valueProperty) {\n      // form: --mixin2: var(--mixin1), where --mixin1 is in the map\n      processVariableAndFallback(valueProperty, (prefix, value) => {\n        if (value && this._map.get(value)) {\n          valueMixin = `@apply ${value};`\n        }\n      });\n    }\n    if (!valueMixin) {\n      return matchText;\n    }\n    let mixinAsProperties = this._consumeCssProperties(valueMixin);\n    let prefix = matchText.slice(0, matchText.indexOf('--'));\n    let mixinValues = this._cssTextToMap(mixinAsProperties);\n    let combinedProps = mixinValues;\n    let mixinEntry = this._map.get(propertyName);\n    let oldProps = mixinEntry && mixinEntry.properties;\n    if (oldProps) {\n      // NOTE: since we use mixin, the map of properties is updated here\n      // and this is what we want.\n      combinedProps = Object.assign(Object.create(oldProps), mixinValues);\n    } else {\n      this._map.set(propertyName, combinedProps);\n    }\n    let out = [];\n    let p, v;\n    // set variables defined by current mixin\n    let needToInvalidate = false;\n    for (p in combinedProps) {\n      v = mixinValues[p];\n      // if property not defined by current mixin, set initial\n      if (v === undefined) {\n        v = 'initial';\n      }\n      if (oldProps && !(p in oldProps)) {\n        needToInvalidate = true;\n      }\n      out.push(`${propertyName}${MIXIN_VAR_SEP}${p}: ${v}`);\n    }\n    if (needToInvalidate) {\n      this._invalidateMixinEntry(mixinEntry);\n    }\n    if (mixinEntry) {\n      mixinEntry.properties = combinedProps;\n    }\n    // because the mixinMap is global, the mixin might conflict with\n    // a different scope's simple variable definition:\n    // Example:\n    // some style somewhere:\n    // --mixin1:{ ... }\n    // --mixin2: var(--mixin1);\n    // some other element:\n    // --mixin1: 10px solid red;\n    // --foo: var(--mixin1);\n    // In this case, we leave the original variable definition in place.\n    if (valueProperty) {\n      prefix = `${matchText};${prefix}`;\n    }\n    return `${prefix}${out.join('; ')};`;\n  }\n}\n\n/* exports */\nApplyShim.prototype['detectMixin'] = ApplyShim.prototype.detectMixin;\nApplyShim.prototype['transformStyle'] = ApplyShim.prototype.transformStyle;\nApplyShim.prototype['transformCustomStyle'] = ApplyShim.prototype.transformCustomStyle;\nApplyShim.prototype['transformRules'] = ApplyShim.prototype.transformRules;\nApplyShim.prototype['transformRule'] = ApplyShim.prototype.transformRule;\nApplyShim.prototype['transformTemplate'] = ApplyShim.prototype.transformTemplate;\nApplyShim.prototype['_separator'] = MIXIN_VAR_SEP;\nObject.defineProperty(ApplyShim.prototype, 'invalidCallback', {\n  /** @return {?function(string)} */\n  get() {\n    return invalidCallback;\n  },\n  /** @param {?function(string)} cb */\n  set(cb) {\n    invalidCallback = cb;\n  }\n});\n\nexport default ApplyShim;","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport ApplyShim from '../src/apply-shim'\nimport templateMap from '../src/template-map'\nimport {getIsExtends} from '../src/style-util'\nimport * as ApplyShimUtils from '../src/apply-shim-utils'\nimport {getComputedStyleValue, updateNativeProperties} from '../src/common-utils'\n\n/** @const {ApplyShim} */\nconst applyShim = new ApplyShim();\n\nclass ApplyShimInterface {\n  constructor() {\n    this.customStyleInterface = null;\n    this.booted = false;\n  }\n  ensure() {\n    if (this.booted) {\n      return;\n    }\n    this.customStyleInterface = window['ShadyCSS']['CustomStyleInterface'];\n    if (this.customStyleInterface) {\n      this.customStyleInterface['transformCallback'] = (style) => {\n        applyShim.transformCustomStyle(style);\n      };\n      this.customStyleInterface['validateCallback'] = () => {\n        this.flushCustomStyles();\n        if (ApplyShimUtils.elementsAreInvalid()) {\n          this.styleDocument();\n        }\n      }\n    }\n    this.booted = true;\n  }\n  /**\n   * @param {!HTMLTemplateElement} template\n   * @param {string} elementName\n   */\n  prepareTemplate(template, elementName) {\n    this.ensure();\n    templateMap[elementName] = template;\n    applyShim.transformTemplate(template, elementName);\n  }\n  flushCustomStyles() {\n    this.ensure();\n    if (this.customStyleInterface) {\n      this.customStyleInterface['findStyles']();\n      let styles = this.customStyleInterface['customStyles'];\n      for (let i = 0; i < styles.length; i++ ) {\n        let cs = styles[i];\n        let style = this.customStyleInterface['getStyleForCustomStyle'](cs);\n        if (style) {\n          applyShim.transformCustomStyle(style);\n        }\n      }\n      this.customStyleInterface['enqueued'] = false;\n    }\n  }\n  /**\n   * @param {Element} element\n   * @param {Object=} properties\n   */\n  styleSubtree(element, properties) {\n    this.ensure();\n    if (properties) {\n      updateNativeProperties(element, properties);\n    }\n    if (element.shadowRoot) {\n      this.styleElement(element);\n      let shadowChildren = element.shadowRoot.children || element.shadowRoot.childNodes;\n      for (let i = 0; i < shadowChildren.length; i++) {\n        this.styleSubtree(shadowChildren[i]);\n      }\n    }\n    let children = element.children || element.childNodes;\n    for (let i = 0; i < children.length; i++) {\n      this.styleSubtree(children[i]);\n    }\n  }\n  /**\n   * @param {Element} element\n   */\n  styleElement(element) {\n    this.ensure();\n    let {is} = getIsExtends(element);\n    let template = templateMap[is];\n    if (template && !ApplyShimUtils.templateIsValid(template)) {\n      // only revalidate template once\n      if (!ApplyShimUtils.templateIsValidating(template)) {\n        this.prepareTemplate(template, is);\n        ApplyShimUtils.startValidatingTemplate(template);\n      }\n      // update all instances\n      let root = element.shadowRoot;\n      if (root) {\n        let style = /** @type {HTMLStyleElement} */(root.querySelector('style'));\n        if (style) {\n          applyShim.transformStyle(style, is);\n        }\n      }\n    }\n  }\n  /**\n   * @param {Object=} properties\n   */\n  styleDocument(properties) {\n    this.ensure();\n    this.styleSubtree(document.documentElement, properties);\n  }\n}\n\nconst applyShimInterface = new ApplyShimInterface();\n\nif (!window['ShadyCSS']) {\n  window['ShadyCSS'] = {\n    /**\n     * @param {HTMLTemplateElement} template\n     * @param {string} elementName\n     * @param {string=} elementExtends\n     */\n    ['prepareTemplate'](template, elementName, elementExtends) { // eslint-disable-line no-unused-vars\n      applyShimInterface.prepareTemplate(template, elementName)\n    },\n\n    /**\n     * @param {Element} element\n     * @param {Object=} properties\n     */\n    ['styleSubtree'](element, properties) {\n      applyShimInterface.styleSubtree(element, properties);\n    },\n\n    /**\n     * @param {Element} element\n     */\n    ['styleElement'](element) {\n      applyShimInterface.styleElement(element);\n    },\n\n    /**\n     * @param {Object=} properties\n     */\n    ['styleDocument'](properties) {\n      applyShimInterface.styleDocument(properties);\n    },\n\n    /**\n     * @param {Element} element\n     * @param {string} property\n     * @return {string}\n     */\n    ['getComputedStyleValue'](element, property) {\n      return getComputedStyleValue(element, property);\n    },\n    ['nativeCss']: true,\n    ['nativeShadow']: true\n  };\n}\n\nwindow['ShadyCSS']['ApplyShim'] = applyShim;","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\n/**\n * @param {Element} element\n * @param {Object=} properties\n */\nexport function updateNativeProperties(element, properties) {\n  // remove previous properties\n  for (let p in properties) {\n    // NOTE: for bc with shim, don't apply null values.\n    if (p === null) {\n      element.style.removeProperty(p);\n    } else {\n      element.style.setProperty(p, properties[p]);\n    }\n  }\n}\n\n/**\n * @param {Element} element\n * @param {string} property\n * @return {string}\n */\nexport function getComputedStyleValue(element, property) {\n  return window.getComputedStyle(element).getPropertyValue(property).trim();\n}"]}