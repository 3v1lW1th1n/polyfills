{"version":3,"file":"custom-style-interface.min.js","sources":["../src/document-wait.js","../src/custom-style-interface.js","custom-style-interface.js"],"sourcesContent":["/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\n/** @type {Promise<void>} */\nlet readyPromise = null;\n\n/** @type {?function(function())} */\nlet whenReady = window['HTMLImports'] && window['HTMLImports']['whenReady'] || null;\n\n/**\n * @param {function()} callback\n */\nexport default function documentWait(callback) {\n  if (whenReady) {\n    whenReady(callback)\n  } else {\n    if (!readyPromise) {\n      /** @type {function()} */\n      let resolveFn;\n      readyPromise = new Promise((resolve) => {resolveFn = resolve});\n      if (document.readyState === 'complete') {\n        resolveFn();\n      } else {\n        document.addEventListener('readystatechange', () => {\n          if (document.readyState === 'complete') {\n            resolveFn();\n          }\n        });\n      }\n    }\n    readyPromise.then(callback);\n  }\n}","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport documentWait from './document-wait'\n\n'use strict';\n\n/**\n * @typedef {HTMLStyleElement | ({getStyle: (function():HTMLStyleElement)})}\n */\nlet CustomStyleProvider; // eslint-disable-line no-unused-vars\n\nconst PROCESSED_MARKER = '__processedByShadyCSS';\nconst SEEN_MARKER = '__seenByShadyCSS';\n\n/** @type {?function(!HTMLStyleElement)} */\nlet transformFn = null;\n\n/** @type {?function()} */\nlet validateFn = null;\n\n/**\nThis interface is provided to add document-level <style> elements to ShadyCSS for processing.\nThese styles must be processed by ShadyCSS to simulate ShadowRoot upper-bound encapsulation from outside styles\nIn addition, these styles may also need to be processed for @apply rules and CSS Custom Properties\n\nTo add document-level styles to ShadyCSS, one can call `ShadyCSS.addDocumentStyle(styleElement)` or `ShadyCSS.addDocumentStyle({getStyle: () => styleElement})`\n\nIn addition, if the process used to discover document-level styles can be synchronously flushed, one should set `ShadyCSS.documentStyleFlush`.\nThis function will be called when calculating styles.\n\nAn example usage of the document-level styling api can be found in `examples/document-style-lib.js`\n\n@unrestricted\n*/\nexport default class CustomStyleInterface {\n  constructor() {\n    /** @type {!Array<!CustomStyleProvider>} */\n    this['customStyles'] = [];\n    this['enqueued'] = false;\n  }\n  /**\n   * Queue a validation for new custom styles to batch style recalculations\n   */\n  enqueueDocumentValidation() {\n    if (this['enqueued']) {\n      return;\n    }\n    this['enqueued'] = true;\n    documentWait(() => {\n      validateFn();\n    });\n  }\n  /**\n   * @param {!HTMLStyleElement} style\n   */\n  addCustomStyle(style) {\n    if (!style[SEEN_MARKER]) {\n      style[SEEN_MARKER] = true;\n      this['customStyles'].push(style);\n      this.enqueueDocumentValidation();\n    }\n  }\n  /**\n   * @param {!CustomStyleProvider} customStyle\n   * @return {HTMLStyleElement}\n   */\n  getStyleForCustomStyle(customStyle) {\n    let style;\n    if (customStyle['getStyle']) {\n      style = customStyle['getStyle']();\n    } else {\n      style = customStyle;\n    }\n    return style;\n  }\n  findStyles() {\n    let cs = this['customStyles'];\n    for (let i = 0; i < cs.length; i++) {\n      let customStyle = cs[i];\n      if (customStyle[PROCESSED_MARKER]) {\n        continue;\n      }\n      let style = this.getStyleForCustomStyle(customStyle);\n      if (style) {\n        customStyle[PROCESSED_MARKER] = true;\n        // HTMLImports polyfill may have cloned the style into the main document,\n        // which is referenced with __appliedElement.\n        // Also, we must copy over the attributes.\n        let appliedStyle = /** @type {HTMLStyleElement} */(style['__appliedElement']);\n        if (appliedStyle) {\n          for (let i = 0; i < style.attributes.length; i++) {\n            let attr = style.attributes[i];\n            appliedStyle.setAttribute(attr.name, attr.value);\n          }\n        }\n        if (transformFn) {\n          transformFn(appliedStyle || style);\n        }\n      }\n    }\n  }\n}\n\nCustomStyleInterface.prototype['addCustomStyle'] = CustomStyleInterface.prototype.addCustomStyle;\nCustomStyleInterface.prototype['getStyleForCustomStyle'] = CustomStyleInterface.prototype.getStyleForCustomStyle;\nCustomStyleInterface.prototype['findStyles'] = CustomStyleInterface.prototype.findStyles;\n\nObject.defineProperties(CustomStyleInterface.prototype, {\n  'transformCallback': {\n    /** @return {?function(!HTMLStyleElement)} */\n    get() {\n      return transformFn;\n    },\n    /** @param {?function(!HTMLStyleElement)} fn */\n    set(fn) {\n      transformFn = fn;\n    }\n  },\n  'validateCallback': {\n    /** @return {?function()} */\n    get() {\n      return validateFn;\n    },\n    /** @param {?function()} fn */\n    set(fn) {\n      validateFn = fn;\n    },\n  }\n})","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport CustomStyleInterface from '../src/custom-style-interface'\n\nwindow['CustomStyleInterface'] = new CustomStyleInterface();"],"names":[],"mappings":"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","preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9Vc2Vycy9kZnJlZWRtL3BvbHltZXIvY29tcG9uZW50cy9zaGFkeWNzcy9zcmMvZG9jdW1lbnQtd2FpdC5qcyIsIi9Vc2Vycy9kZnJlZWRtL3BvbHltZXIvY29tcG9uZW50cy9zaGFkeWNzcy9zcmMvY3VzdG9tLXN0eWxlLWludGVyZmFjZS5qcyIsIi9Vc2Vycy9kZnJlZWRtL3BvbHltZXIvY29tcG9uZW50cy9zaGFkeWNzcy9lbnRyeXBvaW50cy9jdXN0b20tc3R5bGUtaW50ZXJmYWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuQGxpY2Vuc2VcbkNvcHlyaWdodCAoYykgMjAxNyBUaGUgUG9seW1lciBQcm9qZWN0IEF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG5UaGlzIGNvZGUgbWF5IG9ubHkgYmUgdXNlZCB1bmRlciB0aGUgQlNEIHN0eWxlIGxpY2Vuc2UgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL0xJQ0VOU0UudHh0XG5UaGUgY29tcGxldGUgc2V0IG9mIGF1dGhvcnMgbWF5IGJlIGZvdW5kIGF0IGh0dHA6Ly9wb2x5bWVyLmdpdGh1Yi5pby9BVVRIT1JTLnR4dFxuVGhlIGNvbXBsZXRlIHNldCBvZiBjb250cmlidXRvcnMgbWF5IGJlIGZvdW5kIGF0IGh0dHA6Ly9wb2x5bWVyLmdpdGh1Yi5pby9DT05UUklCVVRPUlMudHh0XG5Db2RlIGRpc3RyaWJ1dGVkIGJ5IEdvb2dsZSBhcyBwYXJ0IG9mIHRoZSBwb2x5bWVyIHByb2plY3QgaXMgYWxzb1xuc3ViamVjdCB0byBhbiBhZGRpdGlvbmFsIElQIHJpZ2h0cyBncmFudCBmb3VuZCBhdCBodHRwOi8vcG9seW1lci5naXRodWIuaW8vUEFURU5UUy50eHRcbiovXG5cbid1c2Ugc3RyaWN0JztcblxuLyoqIEB0eXBlIHtQcm9taXNlPHZvaWQ+fSAqL1xubGV0IHJlYWR5UHJvbWlzZSA9IG51bGw7XG5cbi8qKiBAdHlwZSB7P2Z1bmN0aW9uKGZ1bmN0aW9uKCkpfSAqL1xubGV0IHdoZW5SZWFkeSA9IHdpbmRvd1snSFRNTEltcG9ydHMnXSAmJiB3aW5kb3dbJ0hUTUxJbXBvcnRzJ11bJ3doZW5SZWFkeSddIHx8IG51bGw7XG5cbi8qKlxuICogQHBhcmFtIHtmdW5jdGlvbigpfSBjYWxsYmFja1xuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBkb2N1bWVudFdhaXQoY2FsbGJhY2spIHtcbiAgaWYgKHdoZW5SZWFkeSkge1xuICAgIHdoZW5SZWFkeShjYWxsYmFjaylcbiAgfSBlbHNlIHtcbiAgICBpZiAoIXJlYWR5UHJvbWlzZSkge1xuICAgICAgLyoqIEB0eXBlIHtmdW5jdGlvbigpfSAqL1xuICAgICAgbGV0IHJlc29sdmVGbjtcbiAgICAgIHJlYWR5UHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7cmVzb2x2ZUZuID0gcmVzb2x2ZX0pO1xuICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHtcbiAgICAgICAgcmVzb2x2ZUZuKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdyZWFkeXN0YXRlY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7XG4gICAgICAgICAgICByZXNvbHZlRm4oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZWFkeVByb21pc2UudGhlbihjYWxsYmFjayk7XG4gIH1cbn0iLCIvKipcbkBsaWNlbnNlXG5Db3B5cmlnaHQgKGMpIDIwMTYgVGhlIFBvbHltZXIgUHJvamVjdCBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuVGhpcyBjb2RlIG1heSBvbmx5IGJlIHVzZWQgdW5kZXIgdGhlIEJTRCBzdHlsZSBsaWNlbnNlIGZvdW5kIGF0IGh0dHA6Ly9wb2x5bWVyLmdpdGh1Yi5pby9MSUNFTlNFLnR4dFxuVGhlIGNvbXBsZXRlIHNldCBvZiBhdXRob3JzIG1heSBiZSBmb3VuZCBhdCBodHRwOi8vcG9seW1lci5naXRodWIuaW8vQVVUSE9SUy50eHRcblRoZSBjb21wbGV0ZSBzZXQgb2YgY29udHJpYnV0b3JzIG1heSBiZSBmb3VuZCBhdCBodHRwOi8vcG9seW1lci5naXRodWIuaW8vQ09OVFJJQlVUT1JTLnR4dFxuQ29kZSBkaXN0cmlidXRlZCBieSBHb29nbGUgYXMgcGFydCBvZiB0aGUgcG9seW1lciBwcm9qZWN0IGlzIGFsc29cbnN1YmplY3QgdG8gYW4gYWRkaXRpb25hbCBJUCByaWdodHMgZ3JhbnQgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL1BBVEVOVFMudHh0XG4qL1xuXG5pbXBvcnQgZG9jdW1lbnRXYWl0IGZyb20gJy4vZG9jdW1lbnQtd2FpdCdcblxuJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIEB0eXBlZGVmIHtIVE1MU3R5bGVFbGVtZW50IHwgKHtnZXRTdHlsZTogKGZ1bmN0aW9uKCk6SFRNTFN0eWxlRWxlbWVudCl9KX1cbiAqL1xubGV0IEN1c3RvbVN0eWxlUHJvdmlkZXI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnNcblxuY29uc3QgUFJPQ0VTU0VEX01BUktFUiA9ICdfX3Byb2Nlc3NlZEJ5U2hhZHlDU1MnO1xuY29uc3QgU0VFTl9NQVJLRVIgPSAnX19zZWVuQnlTaGFkeUNTUyc7XG5cbi8qKiBAdHlwZSB7P2Z1bmN0aW9uKCFIVE1MU3R5bGVFbGVtZW50KX0gKi9cbmxldCB0cmFuc2Zvcm1GbiA9IG51bGw7XG5cbi8qKiBAdHlwZSB7P2Z1bmN0aW9uKCl9ICovXG5sZXQgdmFsaWRhdGVGbiA9IG51bGw7XG5cbi8qKlxuVGhpcyBpbnRlcmZhY2UgaXMgcHJvdmlkZWQgdG8gYWRkIGRvY3VtZW50LWxldmVsIDxzdHlsZT4gZWxlbWVudHMgdG8gU2hhZHlDU1MgZm9yIHByb2Nlc3NpbmcuXG5UaGVzZSBzdHlsZXMgbXVzdCBiZSBwcm9jZXNzZWQgYnkgU2hhZHlDU1MgdG8gc2ltdWxhdGUgU2hhZG93Um9vdCB1cHBlci1ib3VuZCBlbmNhcHN1bGF0aW9uIGZyb20gb3V0c2lkZSBzdHlsZXNcbkluIGFkZGl0aW9uLCB0aGVzZSBzdHlsZXMgbWF5IGFsc28gbmVlZCB0byBiZSBwcm9jZXNzZWQgZm9yIEBhcHBseSBydWxlcyBhbmQgQ1NTIEN1c3RvbSBQcm9wZXJ0aWVzXG5cblRvIGFkZCBkb2N1bWVudC1sZXZlbCBzdHlsZXMgdG8gU2hhZHlDU1MsIG9uZSBjYW4gY2FsbCBgU2hhZHlDU1MuYWRkRG9jdW1lbnRTdHlsZShzdHlsZUVsZW1lbnQpYCBvciBgU2hhZHlDU1MuYWRkRG9jdW1lbnRTdHlsZSh7Z2V0U3R5bGU6ICgpID0+IHN0eWxlRWxlbWVudH0pYFxuXG5JbiBhZGRpdGlvbiwgaWYgdGhlIHByb2Nlc3MgdXNlZCB0byBkaXNjb3ZlciBkb2N1bWVudC1sZXZlbCBzdHlsZXMgY2FuIGJlIHN5bmNocm9ub3VzbHkgZmx1c2hlZCwgb25lIHNob3VsZCBzZXQgYFNoYWR5Q1NTLmRvY3VtZW50U3R5bGVGbHVzaGAuXG5UaGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdoZW4gY2FsY3VsYXRpbmcgc3R5bGVzLlxuXG5BbiBleGFtcGxlIHVzYWdlIG9mIHRoZSBkb2N1bWVudC1sZXZlbCBzdHlsaW5nIGFwaSBjYW4gYmUgZm91bmQgaW4gYGV4YW1wbGVzL2RvY3VtZW50LXN0eWxlLWxpYi5qc2BcblxuQHVucmVzdHJpY3RlZFxuKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEN1c3RvbVN0eWxlSW50ZXJmYWNlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLyoqIEB0eXBlIHshQXJyYXk8IUN1c3RvbVN0eWxlUHJvdmlkZXI+fSAqL1xuICAgIHRoaXNbJ2N1c3RvbVN0eWxlcyddID0gW107XG4gICAgdGhpc1snZW5xdWV1ZWQnXSA9IGZhbHNlO1xuICB9XG4gIC8qKlxuICAgKiBRdWV1ZSBhIHZhbGlkYXRpb24gZm9yIG5ldyBjdXN0b20gc3R5bGVzIHRvIGJhdGNoIHN0eWxlIHJlY2FsY3VsYXRpb25zXG4gICAqL1xuICBlbnF1ZXVlRG9jdW1lbnRWYWxpZGF0aW9uKCkge1xuICAgIGlmICh0aGlzWydlbnF1ZXVlZCddKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXNbJ2VucXVldWVkJ10gPSB0cnVlO1xuICAgIGRvY3VtZW50V2FpdCgoKSA9PiB7XG4gICAgICB2YWxpZGF0ZUZuKCk7XG4gICAgfSk7XG4gIH1cbiAgLyoqXG4gICAqIEBwYXJhbSB7IUhUTUxTdHlsZUVsZW1lbnR9IHN0eWxlXG4gICAqL1xuICBhZGRDdXN0b21TdHlsZShzdHlsZSkge1xuICAgIGlmICghc3R5bGVbU0VFTl9NQVJLRVJdKSB7XG4gICAgICBzdHlsZVtTRUVOX01BUktFUl0gPSB0cnVlO1xuICAgICAgdGhpc1snY3VzdG9tU3R5bGVzJ10ucHVzaChzdHlsZSk7XG4gICAgICB0aGlzLmVucXVldWVEb2N1bWVudFZhbGlkYXRpb24oKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEBwYXJhbSB7IUN1c3RvbVN0eWxlUHJvdmlkZXJ9IGN1c3RvbVN0eWxlXG4gICAqIEByZXR1cm4ge0hUTUxTdHlsZUVsZW1lbnR9XG4gICAqL1xuICBnZXRTdHlsZUZvckN1c3RvbVN0eWxlKGN1c3RvbVN0eWxlKSB7XG4gICAgbGV0IHN0eWxlO1xuICAgIGlmIChjdXN0b21TdHlsZVsnZ2V0U3R5bGUnXSkge1xuICAgICAgc3R5bGUgPSBjdXN0b21TdHlsZVsnZ2V0U3R5bGUnXSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdHlsZSA9IGN1c3RvbVN0eWxlO1xuICAgIH1cbiAgICByZXR1cm4gc3R5bGU7XG4gIH1cbiAgZmluZFN0eWxlcygpIHtcbiAgICBsZXQgY3MgPSB0aGlzWydjdXN0b21TdHlsZXMnXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgY3VzdG9tU3R5bGUgPSBjc1tpXTtcbiAgICAgIGlmIChjdXN0b21TdHlsZVtQUk9DRVNTRURfTUFSS0VSXSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGxldCBzdHlsZSA9IHRoaXMuZ2V0U3R5bGVGb3JDdXN0b21TdHlsZShjdXN0b21TdHlsZSk7XG4gICAgICBpZiAoc3R5bGUpIHtcbiAgICAgICAgY3VzdG9tU3R5bGVbUFJPQ0VTU0VEX01BUktFUl0gPSB0cnVlO1xuICAgICAgICAvLyBIVE1MSW1wb3J0cyBwb2x5ZmlsbCBtYXkgaGF2ZSBjbG9uZWQgdGhlIHN0eWxlIGludG8gdGhlIG1haW4gZG9jdW1lbnQsXG4gICAgICAgIC8vIHdoaWNoIGlzIHJlZmVyZW5jZWQgd2l0aCBfX2FwcGxpZWRFbGVtZW50LlxuICAgICAgICAvLyBBbHNvLCB3ZSBtdXN0IGNvcHkgb3ZlciB0aGUgYXR0cmlidXRlcy5cbiAgICAgICAgbGV0IGFwcGxpZWRTdHlsZSA9IC8qKiBAdHlwZSB7SFRNTFN0eWxlRWxlbWVudH0gKi8oc3R5bGVbJ19fYXBwbGllZEVsZW1lbnQnXSk7XG4gICAgICAgIGlmIChhcHBsaWVkU3R5bGUpIHtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0eWxlLmF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBhdHRyID0gc3R5bGUuYXR0cmlidXRlc1tpXTtcbiAgICAgICAgICAgIGFwcGxpZWRTdHlsZS5zZXRBdHRyaWJ1dGUoYXR0ci5uYW1lLCBhdHRyLnZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRyYW5zZm9ybUZuKSB7XG4gICAgICAgICAgdHJhbnNmb3JtRm4oYXBwbGllZFN0eWxlIHx8IHN0eWxlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5DdXN0b21TdHlsZUludGVyZmFjZS5wcm90b3R5cGVbJ2FkZEN1c3RvbVN0eWxlJ10gPSBDdXN0b21TdHlsZUludGVyZmFjZS5wcm90b3R5cGUuYWRkQ3VzdG9tU3R5bGU7XG5DdXN0b21TdHlsZUludGVyZmFjZS5wcm90b3R5cGVbJ2dldFN0eWxlRm9yQ3VzdG9tU3R5bGUnXSA9IEN1c3RvbVN0eWxlSW50ZXJmYWNlLnByb3RvdHlwZS5nZXRTdHlsZUZvckN1c3RvbVN0eWxlO1xuQ3VzdG9tU3R5bGVJbnRlcmZhY2UucHJvdG90eXBlWydmaW5kU3R5bGVzJ10gPSBDdXN0b21TdHlsZUludGVyZmFjZS5wcm90b3R5cGUuZmluZFN0eWxlcztcblxuT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoQ3VzdG9tU3R5bGVJbnRlcmZhY2UucHJvdG90eXBlLCB7XG4gICd0cmFuc2Zvcm1DYWxsYmFjayc6IHtcbiAgICAvKiogQHJldHVybiB7P2Z1bmN0aW9uKCFIVE1MU3R5bGVFbGVtZW50KX0gKi9cbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gdHJhbnNmb3JtRm47XG4gICAgfSxcbiAgICAvKiogQHBhcmFtIHs/ZnVuY3Rpb24oIUhUTUxTdHlsZUVsZW1lbnQpfSBmbiAqL1xuICAgIHNldChmbikge1xuICAgICAgdHJhbnNmb3JtRm4gPSBmbjtcbiAgICB9XG4gIH0sXG4gICd2YWxpZGF0ZUNhbGxiYWNrJzoge1xuICAgIC8qKiBAcmV0dXJuIHs/ZnVuY3Rpb24oKX0gKi9cbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gdmFsaWRhdGVGbjtcbiAgICB9LFxuICAgIC8qKiBAcGFyYW0gez9mdW5jdGlvbigpfSBmbiAqL1xuICAgIHNldChmbikge1xuICAgICAgdmFsaWRhdGVGbiA9IGZuO1xuICAgIH0sXG4gIH1cbn0pIiwiLyoqXG5AbGljZW5zZVxuQ29weXJpZ2h0IChjKSAyMDE3IFRoZSBQb2x5bWVyIFByb2plY3QgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cblRoaXMgY29kZSBtYXkgb25seSBiZSB1c2VkIHVuZGVyIHRoZSBCU0Qgc3R5bGUgbGljZW5zZSBmb3VuZCBhdCBodHRwOi8vcG9seW1lci5naXRodWIuaW8vTElDRU5TRS50eHRcblRoZSBjb21wbGV0ZSBzZXQgb2YgYXV0aG9ycyBtYXkgYmUgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL0FVVEhPUlMudHh0XG5UaGUgY29tcGxldGUgc2V0IG9mIGNvbnRyaWJ1dG9ycyBtYXkgYmUgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL0NPTlRSSUJVVE9SUy50eHRcbkNvZGUgZGlzdHJpYnV0ZWQgYnkgR29vZ2xlIGFzIHBhcnQgb2YgdGhlIHBvbHltZXIgcHJvamVjdCBpcyBhbHNvXG5zdWJqZWN0IHRvIGFuIGFkZGl0aW9uYWwgSVAgcmlnaHRzIGdyYW50IGZvdW5kIGF0IGh0dHA6Ly9wb2x5bWVyLmdpdGh1Yi5pby9QQVRFTlRTLnR4dFxuKi9cblxuaW1wb3J0IEN1c3RvbVN0eWxlSW50ZXJmYWNlIGZyb20gJy4uL3NyYy9jdXN0b20tc3R5bGUtaW50ZXJmYWNlJ1xuXG53aW5kb3dbJ0N1c3RvbVN0eWxlSW50ZXJmYWNlJ10gPSBuZXcgQ3VzdG9tU3R5bGVJbnRlcmZhY2UoKTsiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUE7Ozs7Ozs7Ozs7QUFVQSxBQUVBO0FBQ0EsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDOzs7QUFHeEIsSUFBSSxTQUFTLEdBQUcsTUFBTSxDQUFDLGFBQWEsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxJQUFJLENBQUM7Ozs7O0FBS3BGLEFBQWUsU0FBUyxZQUFZLENBQUMsUUFBUSxFQUFFO0VBQzdDLElBQUksU0FBUyxFQUFFO0lBQ2IsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0dBQ3BCLE1BQU07SUFDTCxJQUFJLENBQUMsWUFBWSxFQUFFOztNQUVqQixJQUFJLFNBQVMsQ0FBQztNQUNkLFlBQVksR0FBRyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sS0FBSyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUEsQ0FBQyxDQUFDLENBQUM7TUFDL0QsSUFBSSxRQUFRLENBQUMsVUFBVSxL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"}