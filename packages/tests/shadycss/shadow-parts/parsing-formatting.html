<!DOCTYPE html>
<!--
@license
Copyright (c) 2020 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<title>shadycss/shadow-parts/parsing-formatting</title>

<script sformattingrc="../test-flags.js"></script>
<script src="../../node_modules/wct-browser-legacy/browser.js"></script>

<script type="module">
  import * as shadowParts from '../../node_modules/@webcomponents/shadycss/src/shadow-parts.js';

  suite('shadow parts: parsing and formatting', () => {
    test('splitPartString', () => {
      assert.deepEqual(shadowParts.splitPartString('foo bar  foo '), [
        'foo',
        'bar',
        'foo',
      ]);
    });

    test('parseExportPartsAttribute', () => {
      assert.deepEqual(shadowParts.parseExportPartsAttribute('foo, bar:baz'), [
        {inner: 'foo', outer: 'foo'},
        {inner: 'bar', outer: 'baz'},
      ]);
    });

    suite('parsePartSelector', () => {
      test('minimal', () => {
        assert.deepEqual(
          shadowParts.parsePartSelector('my-button::part(foo)'),
          {
            combinators: '',
            elementName: 'my-button',
            selectors: '',
            parts: 'foo',
            pseudos: '',
          }
        );
      });

      test('pseudo-class', () => {
        assert.deepEqual(
          shadowParts.parsePartSelector('my-button::part(foo):hover'),
          {
            combinators: '',
            elementName: 'my-button',
            selectors: '',
            parts: 'foo',
            pseudos: ':hover',
          }
        );
      });

      test('pseudo-element', () => {
        assert.deepEqual(
          shadowParts.parsePartSelector('my-button::part(foo)::before'),
          {
            combinators: '',
            elementName: 'my-button',
            selectors: '',
            parts: 'foo',
            pseudos: '::before',
          }
        );
      });

      test('all components', () => {
        assert.deepEqual(
          shadowParts.parsePartSelector(
            '#parent > my-button.fancy::part(foo bar):hover'
          ),
          {
            combinators: '#parent > ',
            elementName: 'my-button',
            selectors: '.fancy',
            parts: 'foo bar',
            pseudos: ':hover',
          }
        );
      });

      test('missing ::part selector', () => {
        assert.deepEqual(
          shadowParts.parsePartSelector('#parent > my-button.fancy::hover'),
          null
        );
      });

      test('missing custom element name', () => {
        assert.deepEqual(
          shadowParts.parsePartSelector(
            '#parent > .fancy::part(foo bar)::hover'
          ),
          null
        );
      });
    });

    test('formatShadyPartAttribute', () => {
      assert.equal(
        shadowParts.formatShadyPartAttribute('x-app', 'x-btn', 'prt1'),
        'x-app:x-btn:prt1'
      );
    });

    test('formatShadyPartSelector', () => {
      assert.equal(
        shadowParts.formatShadyPartSelector('x-app', 'x-btn', 'prt1  prt2 '),
        '[shady-part~="x-app:x-btn:prt1"][shady-part~="x-app:x-btn:prt2"]'
      );
    });
  });
</script>
